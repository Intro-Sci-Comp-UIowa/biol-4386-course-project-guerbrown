levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.25)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.38)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
#dev.off()
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.25)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.35)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
cynip_generation <- setNames(data$cynip_generation, rownames(data))
# Rename the levels of the variable
levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.25)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
#dev.off()
cynip_generation <- setNames(data$cynip_generation, rownames(data))
# Rename the levels of the variable
levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.25)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
#dev.off()
cynip_generation <- setNames(data$cynip_generation, rownames(data))
# Rename the levels of the variable
levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
#dev.off()
cynip_generation <- setNames(data$cynip_generation, rownames(data))
# Rename the levels of the variable
levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="black")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="white")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
#dev.off()
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="black")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="white")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
tion_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="black")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="white")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="white")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
ynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="white")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="white")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="white")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
cynip_generation <- setNames(data$cynip_generation, rownames(data))
# Rename the levels of the variable
levels(cynip_generation) <- unique(data$cynip_generation)
# Recapitulation of the best fit model
cynip_generation.ER <- fitpolyMk(S, cynip_generation, model = "ER")
#pull states off the fitted model object
cynip_generationxx <- apply(cynip_generation.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(cynip_generation.ER$data))
#corHMM does not like to work with + so let's replace those with /
cynip_generationxx <- gsub("+","/", cynip_generationxx, fixed=TRUE)
#build corHMM data frame
cynip_generation.data <- data.frame(Genus_sp = names(cynip_generationxx), cynip_generation = cynip_generationxx)
#Pull out model design matrix from the fitted object
cynip_generation_rate.mat <- cynip_generation.ER$index.matrix
cynip_generation_rate.mat[cynip_generation_rate.mat==0] <- NA
colnames(cynip_generation_rate.mat) <- rownames(cynip_generation_rate.mat) <- gsub("+","/", colnames(cynip_generation_rate.mat), fixed=TRUE)
cynip_generationind <- order(colnames(cynip_generation_rate.mat))
cynip_generation_rate.mat <- cynip_generation_rate.mat[cynip_generationind, cynip_generationind]
#Ancestral States
cynip_generation_fit.marginal <- corHMM(S, cynip_generation.data,
rate.mat = cynip_generation_rate.mat,
node.states = "marginal",
rate.cat = 1, p = cynip_generation.ER$rates,
root.p = cynip_generation.ER$pi)
#Marginal states are stores in $states. Extract this and ensure the model is consistent
cynip_generationasr <- cynip_generation_fit.marginal$states
colnames(cynip_generationasr) <- colnames(cynip_generation_rate.mat)
colnames(cynip_generationasr) <- gsub("/","+", colnames(cynip_generationasr))
# Adding these to the figure
svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_cynip_generation_guerbrown.svg", width = 20, height = 10)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
plot.phylo(S, type = "fan", cex = 1.5, align.tip.label = F, lwd = 2, label.offset = 0.05, use.edge.length = F, open.angle =  163, node.depth = 100)
cynip_generationX <- strsplit(setNames(as.character(cynip_generation_rate.mat), names(cynip_generation_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),2,
dimnames=list(S$tip.label,
c("Asexual","Sexual")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
cynip_generationX[[S$tip.label[i]]]]<-
rep(1/length(cynip_generationX[[S$tip.label[i]]]),
length(cynip_generationX[[S$tip.label[i]]]))
cynip_generationcols <- setNames(c("firebrick1", "dodgerblue1"),
c("Asexual","Sexual"))
par(fg="white")
cynip_generation <- setNames(data$cynip_generation, data$Synergus)
cynip_generationxx <- strsplit(as.character(cynip_generation), split = "+", fixed = T)
cynip_generationpp <- matrix(0, length(cynip_generation), 3, dimnames = list(names(cynip_generation), c("Asexual", "Sexual", "Asexual+Sexual")))
for (i in 1:nrow(cynip_generationpp)) cynip_generationpp[i,cynip_generationxx[[i]]]<-1/length(cynip_generationxx[[i]])
tiplabels(pie = cynip_generationpp, piecol = cynip_generationcols, cex=0.3)
par(fg="white")
piecol <- cynip_generationcols
for(i in 1:ncol(cynip_generationasr)){
cynip_generationnn <- strsplit(colnames(cynip_generationasr)[i],"+", fixed=TRUE)[[1]]
if(length(cynip_generationnn)==1) piecol[i] <- cynip_generationcols[cynip_generationnn]
else if(length(cynip_generationnn)==2) piecol[i] <- colorRampPalette(cynip_generationcols[cynip_generationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(cynip_generationasr)
par(fg="white")
nodelabels(pie = cynip_generationasr, piecol = cynip_generationcols,cex=0.40)
par(fg="black")
legend("left", c("Asexual", "Sexual"), pch = 21, pt.bg = c("firebrick1", "dodgerblue1"), pt.cex = 3, title = "Gall Former Generation", cex = 1.5)
dev.off()

locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow"),
c(INSERT LABELS))
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow"),
c("leaf", "stem", "acorn", "bud"))
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
locationpp <- matrix(0, length(location), 6, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 6, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
#dev.off()
locationpp
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
#dev.off()
locationxx
for (i in 1:nrow(locationpp)) locationpp[i,location[[i]]]<-1/length(location[[i]])
#dev.off()
location
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
locationpp <- matrix(0, length(location), 6, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
locationpp <- matrix(0, length(location), 8, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
#dev.off()
levels(location)
levels(location) <- unique(data$location)
#dev.off()
levels(location)
levels(location) <- unique(data$location)
#dev.off()
levels(location)
location
location
data$location
head(data)
data
setwd("//wsl.localhost/Ubuntu/home/guerbrown/github_local/biol-4386-course-project-guerbrown/data/TraitModeling")
tree <- "//wsl.localhost/Ubuntu/home/guerbrown/github_local/biol-4386-course-project-guerbrown/data/TraitModeling/inqcophy_traitmodeling_SynTree_guerbrown.nex"
traits <- "//wsl.localhost/Ubuntu/home/guerbrown/github_local/biol-4386-course-project-guerbrown/data/TraitModeling/inqcophy_traitmodeling_TraitData_guerbrown.csv"
#Import
S <- readNexus(tree)
#Rooting the phylogeny based on a version of the tree with an outgroup and plotting
root.phylo(S, 1, resolve.root = T)
plot.phylo(S, align.tip.label = T, use.edge.length = F, root.edge = T)
data <- read.csv(traits, row.names = 1)
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
#dev.off()
levels(location)
data
locationpp <- matrix(0, length(location), 6, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
#dev.off()
levels(location)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
#dev.off()
locationpp
for (i in 1:nrow(locationpp)) locationpp[i,locationxx[[i]]]<-1/length(locationxx[[i]])
for (i in 1:nrow(locationpp)) locationpp[i,location[[i]]]<-1/length(location[[i]])
#dev.off()
locationpp
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,location[[i]]]<-1/length(location[[i]])
tiplabels(pie = locationpp, piecol = locationcols, cex=0.15)
par(fg="black")
piecol <- locationcols
for(i in 1:ncol(locationasr)){
locationnn <- strsplit(colnames(locationasr)[i],"+", fixed=TRUE)[[1]]
if(length(locationnn)==1) piecol[i] <- locationcols[locationnn]
else if(length(locationnn)==2) piecol[i] <- colorRampPalette(locationcols[locationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(locationasr)
par(fg="transparent")
nodelabels(pie = locationasr, piecol = locationcols,cex=0.25)
par(fg="black")
legend("left", c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn"), pch = 21, pt.bg = c("blue", "red", "yellow", "black"), pt.cex = 3, title = "INSERT FORMAL location", cex = 1.5)
#dev.off()
locationpp
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,location[[i]]]<-1/length(location[[i]])
tiplabels(pie = locationpp, piecol = locationcols, cex=0.15)
par(fg="black")
piecol <- locationcols
for(i in 1:ncol(locationasr)){
locationnn <- strsplit(colnames(locationasr)[i],"+", fixed=TRUE)[[1]]
if(length(locationnn)==1) piecol[i] <- locationcols[locationnn]
else if(length(locationnn)==2) piecol[i] <- colorRampPalette(locationcols[locationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(locationasr)
par(fg="transparent")
nodelabels(pie = locationasr, piecol = locationcols,cex=0.25)
par(fg="black")
legend("left", c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn"), pch = 21, pt.bg = c("blue", "red", "yellow", "black", "brown", "purple", "orange"), pt.cex = 3, title = "INSERT FORMAL location", cex = 1.5)
location <- setNames(data$location, rownames(data))
levels(location) <- unique(data$location)
location.ER <- fitpolyMk(S, location, model = "ER")
locationxx <- apply(location.ER$data,1,
function(x,ss) ss[which(x==1)],
ss=colnames(location.ER$data))
locationxx <- gsub("+","/", locationxx, fixed=TRUE)
location.data <- data.frame(Genus_sp = names(locationxx), location = locationxx)
location_rate.mat <- location.ER$index.matrix
location_rate.mat[location_rate.mat==0] <- NA
colnames(location_rate.mat) <- rownames(location_rate.mat) <- gsub("+","/", colnames(location_rate.mat), fixed=TRUE)
locationind <- order(colnames(location_rate.mat))
location_rate.mat <- location_rate.mat[locationind, locationind]
location_fit.marginal <- corHMM(S, location.data,
rate.mat = location_rate.mat,
node.states = "marginal",
rate.cat = 1, p = location.ER$rates,
root.p = location.ER$pi)
locationasr <- location_fit.marginal$states
colnames(locationasr) <- colnames(location_rate.mat)
colnames(locationasr) <- gsub("/","+", colnames(locationasr))
#svg("/home/guerbrown/github_local/biol-4386-course-project-guerbrown/output/inqcophy_traitmodeling_location_guerbrown.svg", width = 20, height = 10)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
plot.phylo(S, type = "fan", cex = 2, align.tip.label = F, lwd = 3.5, label.offset = 0.1, use.edge.length = F, open.angle =  165)
locationX <- strsplit(setNames(as.character(location_rate.mat), names(location_rate.mat)),"+", fixed=TRUE)
pies <- matrix(0, Ntip(S),4,
dimnames=list(S$tip.label,
c("leaf", "stem", "acorn", "bud")))
for(i in 1:Ntip(S))
pies[S$tip.label[i],
locationX[[S$tip.label[i]]]]<-
rep(1/length(locationX[[S$tip.label[i]]]),
length(locationX[[S$tip.label[i]]]))
locationcols <- setNames(c("blue", "red", "yellow", "black", "brown", "purple", "orange"),
c("leaf", "stem", "acorn", "bud"))
par(fg="black")
location <- setNames(data$location, data$Synergus)
locationxx <- strsplit(as.character(location), split = "+", fixed = T)
locationpp <- matrix(0, length(location), 7, dimnames = list(names(location), c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn")))
for (i in 1:nrow(locationpp)) locationpp[i,location[[i]]]<-1/length(location[[i]])
tiplabels(pie = locationpp, piecol = locationcols, cex=0.15)
par(fg="black")
piecol <- locationcols
for(i in 1:ncol(locationasr)){
locationnn <- strsplit(colnames(locationasr)[i],"+", fixed=TRUE)[[1]]
if(length(locationnn)==1) piecol[i] <- locationcols[locationnn]
else if(length(locationnn)==2) piecol[i] <- colorRampPalette(locationcols[locationnn])(3)[2]
else piecol[i]<-"black"
}
names(piecol)<-colnames(locationasr)
par(fg="transparent")
nodelabels(pie = locationasr, piecol = locationcols,cex=0.25)
par(fg="black")
legend("left", c("leaf", "stem", "stem+leaf", "petiole+stem", "acorn", "bud", "bud+leaf+acorn"), pch = 21, pt.bg = c("blue", "red", "yellow", "black", "brown", "purple", "orange"), pt.cex = 3, title = "INSERT FORMAL location", cex = 1.5)
#dev.off()
locationpp
